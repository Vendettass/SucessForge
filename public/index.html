<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>LeaderBord Steam Success for the 100% Hunters</title>
  <!-- Tailwind via CDN pour aller vite -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-slate-900 text-slate-100">

  <div class="max-w-5xl mx-auto py-10 px-4">
    <h1 class="text-3xl font-bold mb-6 text-center">
      Bibliothèque Steam
    </h1>

    <!-- Form SteamID -->
    <div class="mb-6 flex flex-col sm:flex-row gap-3 items-center justify-center">
      <input id="steamid-input"
             type="text"
             placeholder="Entre un SteamID64"
             class="w-full sm:w-80 px-3 py-2 rounded-lg bg-slate-800 border border-slate-700 focus:outline-none focus:ring-2 focus:ring-emerald-400" />

      <button id="load-btn"
              class="px-4 py-2 rounded-lg bg-emerald-500 hover:bg-emerald-400 text-slate-900 font-semibold">
        Charger la bibliothèque
      </button>
    </div>

    <!-- Message / erreurs -->
    <p id="message" class="text-center text-sm text-slate-400 mb-4"></p>

    <!-- Liste des jeux -->
    <div id="games-grid" class="grid gap-4 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3"></div>

    <!-- Détails des succès -->
    <div id="achievements-panel" class="mt-10 hidden">
      <h2 id="achievements-title" class="text-2xl font-semibold mb-4"></h2>
      <div id="achievements-list" class="space-y-3"></div>
    </div>
  </div>

  <script>
    const apiBase = 'SuccessForge/api'; // adapter selon ta structure

    const steamIdInput = document.getElementById('steamid-input');
    const loadBtn      = document.getElementById('load-btn');
    const msgEl        = document.getElementById('message');
    const gamesGrid    = document.getElementById('games-grid');
    const achPanel     = document.getElementById('achievements-panel');
    const achTitle     = document.getElementById('achievements-title');
    const achList      = document.getElementById('achievements-list');

    loadBtn.addEventListener('click', () => {
      const steamId = steamIdInput.value.trim();
      if (!steamId) {
        msgEl.textContent = "Merci d'entrer un SteamID64.";
        return;
      }
      loadGames(steamId);
    });

    async function loadGames(steamId) {
      msgEl.textContent = "Chargement des jeux...";
      gamesGrid.innerHTML = "";
      achPanel.classList.add('hidden');

      try {
        const res = await fetch(`${apiBase}/games.php?steamid=${encodeURIComponent(steamId)}`);
        if (!res.ok) throw new Error("Erreur HTTP " + res.status);
        const games = await res.json();

        if (!Array.isArray(games) || games.length === 0) {
          msgEl.textContent = "Aucun jeu trouvé (profil privé ou SteamID incorrect ?)";
          return;
        }

        msgEl.textContent = `${games.length} jeu(x) trouvé(s). Clique sur un jeu pour voir ses succès.`;

        gamesGrid.innerHTML = "";
        games.forEach(game => {
          const card = document.createElement('button');
          card.className = "bg-slate-800 rounded-2xl overflow-hidden shadow hover:shadow-lg hover:-translate-y-1 transition flex flex-col text-left";
          card.innerHTML = `
            <img src="${game.cover}" alt="${game.name}" class="w-full object-cover">
            <div class="p-3">
              <h3 class="font-semibold text-sm">${game.name}</h3>
              <p class="text-xs text-slate-400 mt-1">
                Temps de jeu : ${(game.playtime_forever / 60).toFixed(1)} h
              </p>
            </div>
          `;
          card.addEventListener('click', () => {
            loadAchievements(game.appid, game.name);
          });
          gamesGrid.appendChild(card);
        });

      } catch (err) {
        console.error(err);
        msgEl.textContent = "Erreur lors du chargement des jeux.";
      }
    }

    async function loadAchievements(appid, gameName) {
      msgEl.textContent = `Chargement des succès de ${gameName}...`;
      achPanel.classList.add('hidden');
      achList.innerHTML = "";

      try {
        const res = await fetch(`${apiBase}/achievements.php?appid=${encodeURIComponent(appid)}`);
        if (!res.ok) throw new Error("Erreur HTTP " + res.status);
        const achievements = await res.json();

        achTitle.textContent = `Succès pour ${gameName}`;
        achList.innerHTML = "";

        if (!Array.isArray(achievements) || achievements.length === 0) {
          achList.innerHTML = `<p class="text-slate-400 text-sm">Aucun succès trouvé pour ce jeu.</p>`;
        } else {
          achievements.forEach(ach => {
            const div = document.createElement('div');
            div.className = "flex gap-3 bg-slate-800 rounded-xl p-3";
            div.innerHTML = `
              <img src="${ach.icon || ach.icon_gray}" alt="${ach.name}"
                   class="w-10 h-10 rounded-md object-cover flex-shrink-0">
              <div>
                <p class="font-semibold text-sm">${ach.name}</p>
                <p class="text-xs text-slate-300">${ach.description || ''}</p>
                <p class="text-xs text-slate-400 mt-1">
                  Débloqué par ${ach.percent_global !== null ? ach.percent_global.toFixed(2) : 'N/A'}% des joueurs
                </p>
              </div>
            `;
            achList.appendChild(div);
          });
        }

        achPanel.classList.remove('hidden');
        msgEl.textContent = "";
      } catch (err) {
        console.error(err);
        msgEl.textContent = "Erreur lors du chargement des succès.";
      }
    }
  </script>
</body>
</html>